<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>
    <script src="https://www.mapquestapi.com/sdk/leaflet/v2.s/mq-map.js?key=e8KE3frcmrcs4PB7qEZq51Ztnh2ftGC3"></script>
</head>
<body>
    <div id="map" style="width:92%; height:99%; position:absolute"></div>

	<script>
        var lat = 47.62201666666667;
        var lon = -122.335685;

        var mapLayer = MQ.mapLayer(), map;
        var darkLayer = MQ.darkLayer();
        var satelliteLayer = MQ.satelliteLayer();

        map = L.map('map', {
            layers: mapLayer,
            center: [lat, lon],
            zoom: 10
            });

        var popup = L.popup();
        var markerLayer = new L.LayerGroup();
        markerLayer.addTo(map);


        function setMapLayer()
        {
            map.removeLayer(darkLayer);
            map.removeLayer(satelliteLayer);
            map.addLayer(mapLayer);
        }

        function setSatelliteLayer()
        {
            map.removeLayer(mapLayer);
            map.removeLayer(darkLayer);
            map.addLayer(satelliteLayer);
        }

        function setDarkLayer()
        {
            map.removeLayer(mapLayer);
            map.removeLayer(satelliteLayer);
            map.addLayer(darkLayer);
        }


		function setCenter(location, zoom)
		{
			map.setView(location, zoom);
		}

		function fitToBounds(bounds)
		{
			map.fitBounds(bounds);
		}

        var activeMarkers = {};
		function addMarker(id, location, title)
		{
			marker = L.marker(location, { draggable:'true', title:title } );
            setMarkerId(marker, id);
            activeMarkers[id] = marker;

            marker.on('dragend', function(event)
            {
                var marker = event.target;
                var position = marker.getLatLng();
                MapThis.updateMarker(markerId(marker), position.lat, position.lng);
            });
            markerLayer.addLayer(marker);
		}

        function removeMarker(id)
        {
            var marker = activeMarkers[id];
            if (marker != null)
            {
                markerLayer.removeLayer(marker);
                activeMarkers[id] = null;
            }
        }

        function removeAllMarkers()
        {
            markerLayer.clearLayers();
            activeMarkers.length = 0;
        }

		function setPopup(location, s)
		{
			popup
				.setLatLng(location)
				.setContent(s)
				.openOn(map);
		}

		function resetPopup()
		{
			map.closePopup(popup);
		}

		function pointToLatLng(p)
		{
			var ll = map.containerPointToLatLng(p);
			return JSON.stringify(ll);
		}

		function onMapClick(e)
		{
			if (e.originalEvent.altKey)
			{
				MapThis.clicked(e.latlng.lat, e.latlng.lng);
			}
		}

		map.on('click', onMapClick);


        function markerId(obj) 
        {
            return String(obj.__obj_id);
        }

        function setMarkerId(obj, id)
        {
            obj.__obj_id=id;
        }
	</script>
</body>
</html>
